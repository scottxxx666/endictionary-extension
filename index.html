<!DOCTYPE html>
<html>
<head>
    <title>查個英文</title>
</head>
<body>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<script>
(function(d, s, id){
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.com/zh_TW/messenger.Extensions.js";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'Messenger'));
</script>
    <input id="query">
    <button id="search">搜尋</button>
    <div id="result">
        <div id="search_result"></div>
        <button id="share_btn">share to messanger</button>
    </div>
<script>
    window.extAsyncInit = function() {
        // the Messenger Extensions JS SDK is done loading
    };

    var searchResult;

    var fbShare = function fbShare (messageToShare) {
        MessengerExtensions.beginShareFlow(function success(response) {
        // User dismissed without error, but did they
            // share the message?

            if(response.is_sent) {
                // The user actually did share.
                // Perhaps close the window w/ requestCloseBrowser().
                MessengerExtensions.requestCloseBrowser();
            } else {

            }

        }, function error(errorCode, errorMessage) {
        // An error occurred in the process
            alert(errorCode + ":" + errorMessage);
        },
        messageToShare,
        "current_thread");
    }

    var search = function startQuery (query) {
        $.get('https://mbzxexz92l.execute-api.ap-northeast-1.amazonaws.com/production/english', {query: query})
        .done(function(data) {
            console.log(data);
            searchResult = data;
            const response =
`<div>${data.keyword}</div>
<div>${data.kk}</div>
<div>${data.text}</div>`;
            result.innerHTML = response;
        });
    }

    var result = document.getElementById('search_result');

    document.querySelector('#search').addEventListener('click', function() {
        const query = document.getElementById('query').value;
        search(query);
    });

    document.querySelector('#share_btn').addEventListener('click', function() {
        var messageToShare = {
          attachment: {
             type: "template",
             payload: {
                 template_type: 'generic',
                 elements: [{
                     title: searchResult.keyword,
                     image_url: "https://scottxxx666.github.io/endictionary-extension/",
                     subtitle: `${searchResult.kk}\n - ${searchResult.text}`,
                     default_action: {
                         type:"web_url",
                         url: "https://scottxxx666.github.io/endictionary-extension/",
                     },
                     buttons: [{
                         type:"web_url",
                         url:"https://scottxxx666.github.io/endictionary-extension/",
                         title:"detail",
                     }],
                 }]
             }
          }
        };
        fbShare(messageToShare);
    });

</script>
</body>
</html>